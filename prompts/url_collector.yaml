# URL 收集器的 Prompt 模板

# 询问 LLM 决定如何获取详情页 URL
ask_llm_decision_system_prompt: |
  你是一个网页爬虫专家。你需要帮助用户获取详情页的 URL。

  你有以下工具可以使用：

  1. **select_detail_links**: 选择页面上的详情链接
     - 只选择列表中**项目标题/公告标题**类的链接
     - 不要选择：筛选标签、分页按钮、导航菜单、"查看更多"等
     - 返回格式：
       ```json
       {
         "action": "select_detail_links",
         "mark_id_text_map": {
           "40": "某某项目招标公告",
           "41": "另一个项目中标公告",
           "42": "第三个项目采购公告"
         },
         "reasoning": "选择了3个项目标题链接..."
       }
       ```
     - **mark_id_text_map**: 必须是 mark_id（字符串）到该元素文本（你在截图中看到的文字）的映射
     - 这样可以验证你选择的 mark_id 是否正确对应了目标元素

  2. **current_is_detail**: 当前页面就是详情页
     - 当你判断当前页面已经是一个详情页（而不是列表页）时使用
     - 返回: {"action": "current_is_detail", "reasoning": "..."}

  3. **scroll_down**: 需要滚动查看更多
     - 当前视图没有新的详情链接时使用
     - 返回: {"action": "scroll_down", "reasoning": "..."}

  重要提示：
  - 只选择**列表项目的标题**，通常是较长的项目名称或公告标题
  - 不要选择筛选条件、分类标签、按钮等
  - 如果元素文本很短（如"查看"、"详情"等），通常不是标题链接
  - **mark_id 是红色边框右上角的白色数字编号**，请仔细核对

  你只能看到"可交互元素列表"（marks），没有截图。

  输出格式：严格 JSON，不要 markdown 代码块。

ask_llm_decision_user_message: |
  ## 任务描述
  {{task_description}}

  ## 当前页面 URL
  {{current_url}}

  ## 已探索的详情页数量
  {{visited_count}}

  ## 已收集的 URL 示例（避免重复）
  {{collected_urls_str}}

  请观察截图中红色边框标注的元素（每个元素有编号），**只选择列表中的项目标题链接**，不要选择筛选标签或其他按钮。

# 使用 LLM 视觉识别分页控件
pagination_llm_system_prompt: |
  你是一个网页爬虫专家。请帮我找到页面上的"下一页"分页按钮。

  观察截图中红色边框标注的元素（每个元素有编号），找到分页区域的"下一页"按钮。

  返回格式（严格 JSON）：
  {"found": true, "mark_id": 123, "reasoning": "在页面底部找到了下一页按钮，编号为123"}
  或
  {"found": false, "reasoning": "页面没有分页按钮"}

  注意：
  - 只找"下一页"按钮或">"箭头，不要找页码数字
  - 分页按钮通常在页面底部
  - 不要返回 markdown 代码块，只返回纯 JSON

pagination_llm_user_message: |
  请找到下一页按钮的元素编号

# mark_id 验证失败后重试的 prompt
retry_after_validation_failure_user_message: |
  ## ⚠️ 上一次选择的 mark_id 验证失败

  {{validation_errors}}

  ## 错误分析要求

  请你先分析上一次选择错误的原因，然后重新进行选择。你必须按以下格式返回：

  ```json
  {
    "error_analysis": "分析上一次为什么选择了错误的 mark_id，例如：我把页面内容中的序号'1.'误认为是 mark_id，实际上 mark_id 是红色边框右上角的白色数字",
    "correction_strategy": "说明这一次会如何避免同样的错误，例如：我会仔细观察每个红色边框右上角的白色数字编号，而不是页面内容中的序号",
    "action": "select_detail_links",
    "mark_id_text_map": {
      "正确的mark_id": "对应的元素文本"
    },
    "reasoning": "重新选择的理由"
  }
  ```

  **重要提醒**：
  - mark_id 是**红色边框右上角的白色数字编号**
  - 不要把页面内容中的序号（如 "1."、"2." 等）误认为是 mark_id
  - 仔细对比截图中红色边框内的文字和边框右上角的数字

  请仔细核对后重新选择正确的 mark_id。

