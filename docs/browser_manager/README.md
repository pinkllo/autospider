# Browser Manager

Browser Manager æ¨¡å—è´Ÿè´£ç®¡ç†æµè§ˆå™¨å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸã€å¼‚å¸¸å·¡æ£€ä»¥åŠè‡ªåŠ¨åŒ–çš„äº¤äº’å¤„ç†ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œé›†æˆäº†åçˆ¬è™«ã€å¤š Event Loop å…¼å®¹ä»¥åŠå¼‚å¸¸è‡ªåŠ¨æ¢å¤åŠŸèƒ½ã€‚

---

## ğŸ“ æ¨¡å—ç»“æ„

- `engine.py`: æ ¸å¿ƒæµè§ˆå™¨å¼•æ“ï¼Œç®¡ç† `Browser` å®ä¾‹å’Œ `Context` éš”ç¦»ã€‚
- `guard.py`: é¡µé¢å·¡æ£€å‘˜ (`PageGuard`)ï¼Œç›‘å¬é¡µé¢äº‹ä»¶å¹¶è‡ªåŠ¨è§¦å‘å¼‚å¸¸å¤„ç†ã€‚
- `registry.py`: å¤„ç†å™¨æ³¨å†Œè¡¨ï¼Œç®¡ç†å„ç§å¼‚å¸¸å¤„ç†å™¨ï¼ˆå¦‚ç™»å½•ã€éªŒè¯ç ï¼‰ã€‚
- `handlers/`: å­˜æ”¾å…·ä½“çš„å¼‚å¸¸å¤„ç†å™¨å®ç°ã€‚
  - `base.py`: å¤„ç†å™¨åŸºç±»ã€‚
  - `login_handler.py`: ç™»å½•å¼‚å¸¸å¤„ç†ã€‚

---

## ğŸš€ æ ¸å¿ƒç»„ä»¶

### 1. Browser Engine (`engine.py`)
è´Ÿè´£ Playwright æµè§ˆå™¨çš„å¯åŠ¨ä¸ç»´æŠ¤ã€‚
- **å•ä¾‹/é‡ç”¨**: è‡ªåŠ¨ç»´æŠ¤å…¨å±€å”¯ä¸€çš„ `Browser` å®ä¾‹ã€‚
- **åçˆ¬é›†æˆ**: å†…ç½® `playwright-stealth` æ”¯æŒã€‚
- **é²æ£’æ€§**: è‡ªåŠ¨æ£€æµ‹ Event Loop å˜æ›´å¹¶é‡å¯æµè§ˆå™¨ï¼Œå¤„ç†æ–­è¿æ¢å¤ã€‚

### 2. Page Guard (`guard.py`)
è‡ªåŠ¨åŒ–çš„é¡µé¢çŠ¶æ€ç›‘æ§å™¨ã€‚
- **äº‹ä»¶é©±åŠ¨**: æŒ‚è½½åˆ° `Page` çš„ `framenavigated` äº‹ä»¶ã€‚
- **ä¼˜å…ˆçº§è°ƒåº¦**: æ ¹æ®æ³¨å†Œçš„å¤„ç†å™¨ä¼˜å…ˆçº§ï¼ŒæŒ‰é¡ºåºæ£€æµ‹å¼‚å¸¸ã€‚
- **éé˜»å¡**: ä½¿ç”¨å¼‚æ­¥é”ç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªå·¡æ£€ä»»åŠ¡åœ¨è¿è¡Œã€‚

### 3. Handler Registry (`registry.py`)
å¤„ç†å™¨çš„ä¸­å¤®ç®¡ç†å™¨ã€‚
- **åŠ¨æ€æ§åˆ¶**: æ”¯æŒåœ¨è¿è¡Œæ—¶å¯ç”¨æˆ–ç¦ç”¨ç‰¹å®šçš„å¤„ç†å™¨ã€‚
- **æ’åº**: ç¡®ä¿å·¡æ£€æ—¶æŒ‰ `priority` é¡ºåºæ‰§è¡Œæ£€æµ‹ã€‚

---

## ğŸ› ï¸ ä½¿ç”¨ç¤ºä¾‹

```python
from common.browser_manager.engine import BrowserEngine
from common.browser_manager.guard import PageGuard

# 1. åˆå§‹åŒ–å¼•æ“
engine = BrowserEngine(headless=False)

# 2. è·å–é¡µé¢
async with engine.create_context() as context:
    page = await context.new_page()
    
    # 3. æŒ‚è½½å·¡æ£€å‘˜
    guard = PageGuard()
    guard.attach_to_page(page)
    
    # 4. æ­£å¸¸æ“ä½œï¼Œå¼‚å¸¸ï¼ˆå¦‚é‡åˆ°ç™»å½•å¢™ï¼‰å°†ç”± guard è‡ªåŠ¨å¤„ç†
    await page.goto("https://target-site.com")
```
