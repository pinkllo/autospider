# cli.py - CLI å…¥å£

`cli.py` æ¨¡å—æä¾› AutoSpider çš„å‘½ä»¤è¡Œæ¥å£ï¼Œæ”¯æŒè‡ªåŠ¨ç”Ÿæˆé…ç½®ã€æ‰¹é‡é‡‡é›†ä»¥åŠä¸€é”®å¼ URL æ”¶é›†ã€‚

---

## ğŸ“ æ–‡ä»¶è·¯å¾„

```
src/autospider/cli.py
```

---

## ğŸ“‘ å‘½ä»¤æ€»è§ˆ

### ğŸš€ æ ¸å¿ƒå‘½ä»¤
- `collect-urls` - ä¸€é”®å¼æ”¶é›†è¯¦æƒ…é¡µ URLï¼ˆå®Œæ•´æµç¨‹ï¼‰
- `generate-config` - æ¢ç´¢å¹¶ç”Ÿæˆçˆ¬å–é…ç½®æ–‡ä»¶ï¼ˆç¬¬ä¸€é˜¶æ®µï¼‰
- `batch-collect` - åŸºäºé…ç½®æ–‡ä»¶è¿›è¡Œæ‰¹é‡æ”¶é›†ï¼ˆç¬¬äºŒé˜¶æ®µï¼‰

---

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. collect-urls å‘½ä»¤

æ‰§è¡Œå®Œæ•´çš„ URL æ”¶é›†æµç¨‹ï¼šè¯†åˆ«ç›®æ ‡ã€æ¢ç´¢æå–æ¨¡å¼ã€éå†ç¿»é¡µæ”¶é›†ã€‚

```bash
autospider collect-urls \
  --list-url "https://example.com/list" \
  --task "æ”¶é›†æ‹›æ ‡å…¬å‘Šè¯¦æƒ…é¡µ" \
  --explore-count 3 \
  --output "output"
```

**å‚æ•°è¯´æ˜ï¼š**

| å‚æ•° | çŸ­å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|--------|------|
| `--list-url` | `-u` | string | (å¿…å¡«) | åˆ—è¡¨é¡µ URL |
| `--task` | `-t` | string | (å¿…å¡«) | ä»»åŠ¡æè¿°ï¼ˆè‡ªç„¶è¯­è¨€ï¼‰ |
| `--explore-count` | `-n` | int | 3 | æ¢ç´¢è¯¦æƒ…é¡µçš„æ•°é‡ï¼Œç”¨äºæå–æ¨¡å¼ |
| `--headless` | | bool | False | æ˜¯å¦å¼€å¯æ— å¤´æ¨¡å¼ |
| `--output` | `-o` | string | "output" | è¾“å‡ºç›®å½• |
| `--dry-run` | | bool | False | é¢„è§ˆæ¨¡å¼ï¼ŒåªéªŒè¯å‚æ•°ä¸å®é™…æ‰§è¡Œ |

---

### 2. generate-config å‘½ä»¤

ä»…æ‰§è¡Œæ¢ç´¢é˜¶æ®µï¼Œç”ŸæˆåŒ…å«å¯¼èˆªæ­¥éª¤ã€XPathã€åˆ†é¡µæ§ä»¶ç­‰ä¿¡æ¯çš„ `collection_config.json`ã€‚

```bash
autospider generate-config \
  --list-url "https://example.com/list" \
  --task "æ”¶é›†æ‹›æ ‡å…¬å‘Šè¯¦æƒ…é¡µ" \
  --output "output"
```

**å‚æ•°è¯´æ˜ï¼š**

| å‚æ•° | çŸ­å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|--------|------|
| `--list-url` | `-u` | string | (å¿…å¡«) | åˆ—è¡¨é¡µ URL |
| `--task` | `-t` | string | (å¿…å¡«) | ä»»åŠ¡æè¿° |
| `--explore-count` | `-n` | int | 3 | æ¢ç´¢æ•°é‡ |
| `--headless` | | bool | False | æ˜¯å¦æ— å¤´æ¨¡å¼ |
| `--output` | `-o` | string | "output" | è¾“å‡ºç›®å½• |

---

### 3. batch-collect å‘½ä»¤

è¯»å–å·²ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ï¼Œæ‰§è¡Œé«˜æ•ˆçš„æ‰¹é‡é‡‡é›†ã€‚æ”¯æŒæ–­ç‚¹ç»­çˆ¬ã€‚

```bash
autospider batch-collect \
  --config-path "output/collection_config.json" \
  --output "output"
```

**å‚æ•°è¯´æ˜ï¼š**

| å‚æ•° | çŸ­å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|--------|------|
| `--config-path` | `-c` | string | (å¿…å¡«) | é…ç½®æ–‡ä»¶è·¯å¾„ |
| `--headless` | | bool | False | æ˜¯å¦æ— å¤´æ¨¡å¼ |
| `--output` | `-o` | string | "output" | è¾“å‡ºç›®å½• |

---

## ğŸ’¡ æŠ€æœ¯ç‰¹æ€§

### ğŸ›¡ï¸ å®‰å…¨æ‰§è¡Œ (run_async_safely)

CLI å†…éƒ¨é€šè¿‡ `run_async_safely` å‡½æ•°ç®¡ç†å¼‚æ­¥ä»»åŠ¡ã€‚å®ƒç¡®ä¿äº†ï¼š
- åœ¨ Windows ç¯å¢ƒä¸‹å¯¹ `KeyboardInterrupt` (Ctrl+C) çš„ä¼˜é›…å¤„ç†ã€‚
- è‡ªåŠ¨æ¸…ç† Playwright æµè§ˆå™¨è¿›ç¨‹ï¼Œé˜²æ­¢æ®‹ç•™ã€‚
- æ”¯æŒåœ¨å·²æœ‰äº‹ä»¶å¾ªç¯çš„ç¯å¢ƒä¸­åµŒå¥—è¿è¡Œã€‚

### ğŸ¨ äº¤äº’å¼ UI

- **Rich Panel**: ä½¿ç”¨é¢æ¿å±•ç¤ºé…ç½®å’Œç»“æœæ‘˜è¦ã€‚
- **Progress & Spinner**: åœ¨é‡‡é›†è¿‡ç¨‹ä¸­æä¾›å®æ—¶çš„åŠ¨ç”»çŠ¶æ€æç¤ºã€‚
- **Rich Table**: æ ¼å¼åŒ–å±•ç¤ºæ¢ç´¢åˆ°çš„è¯¦æƒ…é¡µåŠå…¶å…ƒæ•°æ®ã€‚

---

## ğŸ”§ ä½¿ç”¨ç¤ºä¾‹

### ä¸€é”®æ”¶é›†ç¤ºä¾‹
```bash
autospider collect-urls -u "https://bulletin.cebpubservice.com/" -t "æ”¶é›†æ‹›æ ‡å…¬å‘Š" --no-headless
```

### åˆ†é˜¶æ®µæ‰§è¡Œç¤ºä¾‹
```bash
# 1. ç”Ÿæˆé…ç½®
autospider generate-config -u "https://example.com/list" -t "é‡‡é›†æ–°é—»"
# 2. æ£€æŸ¥ output/collection_config.json åè¿›è¡Œæ‰¹é‡é‡‡é›†
autospider batch-collect -c output/collection_config.json
```

---

*æœ€åæ›´æ–°: 2026-01-22*
