# æ–­ç‚¹é‡ç»­ä¼˜åŒ–è¯´æ˜

## é—®é¢˜
ä¹‹å‰çš„å®ç°ä¸­ï¼Œå³ä½¿æ–­ç‚¹æ¢å¤æ—¶å·²ç»æœ‰ä¿å­˜çš„é…ç½®ï¼ˆnav_stepsã€XPathç­‰ï¼‰ï¼Œä»ç„¶ä¼šé‡æ–°æ‰§è¡Œ LLM å†³ç­–ï¼Œé€ æˆï¼š
- â±ï¸ **æ—¶é—´æµªè´¹**ï¼šé‡å¤æ‰§è¡Œå·²å®Œæˆçš„æ­¥éª¤
- ğŸ’° **API æµªè´¹**ï¼šé‡å¤è°ƒç”¨ LLM
- ğŸ› **ä¸ç¨³å®šæ€§**ï¼šLLM å¯èƒ½è¿”å›ä¸åŒç»“æœ

## ä¼˜åŒ–æ–¹æ¡ˆ

### é…ç½®å¤ç”¨æœºåˆ¶
åœ¨æ–­ç‚¹æ¢å¤æ—¶ï¼Œ**ä¼˜å…ˆä½¿ç”¨å·²ä¿å­˜çš„é…ç½®**ï¼Œè·³è¿‡ä¸å¿…è¦çš„ LLM å†³ç­–å’Œæ¢ç´¢æ­¥éª¤ã€‚

### ä¼˜åŒ–åçš„æµç¨‹å¯¹æ¯”

#### é¦–æ¬¡è¿è¡Œï¼ˆå®Œæ•´æµç¨‹ï¼‰
```
Phase 0: è¿æ¥ Redis + åŠ è½½å†å²æ•°æ®
Phase 0.5: æ— å†å²é…ç½®
Phase 1: å¯¼èˆªåˆ°åˆ—è¡¨é¡µ
Phase 2: LLM å†³ç­–å¯¼èˆªæ­¥éª¤ â†’ ä¿å­˜ nav_steps
Phase 3: LLM æ¢ç´¢è¯¦æƒ…é¡µï¼ˆ3ä¸ªï¼‰
Phase 3.5: æå–å…¬å…± XPath â†’ ä¿å­˜ common_detail_xpath
Phase 3.6: æå–åˆ†é¡µæ§ä»¶ XPath â†’ ä¿å­˜ pagination_xpath
Phase 3.6.1: æå–è·³è½¬æ§ä»¶ XPath â†’ ä¿å­˜ jump_widget_xpath
Phase 3.7: æ— æ–­ç‚¹æ¢å¤éœ€æ±‚ï¼ˆtarget_page = 1ï¼‰
Phase 4: å¼€å§‹æ”¶é›† URL
Phase 4.5: æŒä¹…åŒ–æ‰€æœ‰é…ç½®
```

#### æ–­ç‚¹æ¢å¤ï¼ˆä¼˜åŒ–åï¼‰
```
Phase 0: è¿æ¥ Redis + åŠ è½½å†å²æ•°æ®ï¼ˆ60ä¸ªURLï¼‰
Phase 0.5: âœ… åŠ è½½ progress.jsonï¼ˆå½“å‰é¡µ=7ï¼‰
         âœ… åŠ è½½ collection_config.jsonï¼ˆnav_steps, XPathç­‰ï¼‰
         
Phase 1: å¯¼èˆªåˆ°åˆ—è¡¨é¡µ

Phase 2: âœ… ç›´æ¥é‡æ”¾ nav_stepsï¼ˆæ— LLMå†³ç­–ï¼‰
         â””â”€ ç‚¹å‡» "ä¸­æ ‡ç»“æœ" ï¼ˆä½¿ç”¨å·²ä¿å­˜çš„XPathï¼‰

Phase 3: âœ… è·³è¿‡æ¢ç´¢ï¼ˆå·²æœ‰ common_detail_xpathï¼‰

Phase 3.5: âœ… è·³è¿‡æå–ï¼ˆç›´æ¥ä½¿ç”¨å·²ä¿å­˜çš„ XPathï¼‰

Phase 3.6: âœ… è·³è¿‡æå–ï¼ˆç›´æ¥ä½¿ç”¨å·²ä¿å­˜çš„ pagination_xpathï¼‰

Phase 3.6.1: âœ… è·³è¿‡æå–ï¼ˆç›´æ¥ä½¿ç”¨å·²ä¿å­˜çš„ jump_widget_xpathï¼‰

Phase 3.7: ğŸš€ æ–­ç‚¹æ¢å¤åˆ°ç¬¬7é¡µ
          â”œâ”€ ç­–ç•¥1: URLè§„å¾‹çˆ†ç ´ âŒ
          â”œâ”€ ç­–ç•¥2: æ§ä»¶ç›´è¾¾ âœ…ï¼ˆä½¿ç”¨å·²ä¿å­˜çš„è·³è½¬æ§ä»¶ï¼‰
          â””â”€ è¾“å…¥é¡µç 7 â†’ è·³è½¬æˆåŠŸ

Phase 4: ä»ç¬¬7é¡µç»§ç»­æ”¶é›† URL
```

## æ€§èƒ½æå‡

### èŠ‚çœçš„æ“ä½œï¼ˆæ–­ç‚¹æ¢å¤æ—¶ï¼‰
- âŒ Phase 2 çš„ LLM å¯¼èˆªå†³ç­–ï¼ˆ1-3æ¬¡ LLM è°ƒç”¨ï¼‰
- âŒ Phase 3 çš„è¯¦æƒ…é¡µæ¢ç´¢ï¼ˆ3æ¬¡é¡µé¢è®¿é—® + 3æ¬¡ LLM è°ƒç”¨ï¼‰
- âŒ Phase 3.5 çš„ XPath æå–ï¼ˆè®¡ç®—å¯†é›†ï¼‰
- âŒ Phase 3.6 çš„åˆ†é¡µæ§ä»¶æå–ï¼ˆå¯èƒ½å« LLM è°ƒç”¨ï¼‰
- âŒ Phase 3.6.1 çš„è·³è½¬æ§ä»¶æå–

### æ—¶é—´èŠ‚çœä¼°ç®—
| é˜¶æ®µ | é¦–æ¬¡è¿è¡Œ | æ–­ç‚¹æ¢å¤ï¼ˆä¼˜åŒ–å‰ï¼‰ | æ–­ç‚¹æ¢å¤ï¼ˆä¼˜åŒ–åï¼‰ | èŠ‚çœ |
|------|---------|-------------------|-------------------|------|
| Phase 2 å¯¼èˆª | ~10s | ~10s | ~2s | 80% |
| Phase 3 æ¢ç´¢ | ~30s | ~30s | è·³è¿‡ | 100% |
| Phase 3.5 æå– | ~5s | ~5s | è·³è¿‡ | 100% |
| Phase 3.6/3.6.1 | ~10s | ~10s | ~1s | 90% |
| **æ€»è®¡** | **~55s** | **~55s** | **~3s** | **~95%** |

*å®é™…æ—¶é—´å–å†³äºç½‘ç»œé€Ÿåº¦å’ŒLLMå“åº”é€Ÿåº¦*

## ä»£ç å®ç°

### å…³é”®æ”¹åŠ¨

#### 1. Phase 0.5 åŠ è½½é…ç½®
```python
# åŠ è½½å†å²è¿›åº¦
previous_progress = self.progress_persistence.load_progress()

# åŠ è½½å†å²é…ç½® âœ… æ–°å¢
previous_config = self.config_persistence.load()

# æ¢å¤ nav_stepsã€XPath ç­‰
if previous_config:
    if previous_config.nav_steps:
        self.nav_steps = previous_config.nav_steps
    if previous_config.common_detail_xpath:
        self.common_detail_xpath = previous_config.common_detail_xpath
```

#### 2. Phase 2 æ™ºèƒ½å¯¼èˆª
```python
if is_resume and self.nav_steps:
    # æ–­ç‚¹æ¢å¤ï¼šç›´æ¥é‡æ”¾
    await self.navigation_handler.replay_nav_steps(self.nav_steps)
else:
    # é¦–æ¬¡è¿è¡Œï¼šLLM å†³ç­–
    await self.navigation_handler.run_navigation_phase()
```

#### 3. Phase 3 æ™ºèƒ½æ¢ç´¢
```python
if is_resume and self.common_detail_xpath:
    # æ–­ç‚¹æ¢å¤ï¼šè·³è¿‡æ¢ç´¢
    print("ä½¿ç”¨å·²ä¿å­˜çš„å…¬å…±è¯¦æƒ…é¡µ XPath")
else:
    # é¦–æ¬¡è¿è¡Œï¼šæ¢ç´¢å¹¶æå–
    await self._explore_phase()
    self.common_detail_xpath = self.xpath_extractor.extract_common_xpath(...)
```

#### 4. Phase 3.6/3.6.1 æ™ºèƒ½æå–
```python
if is_resume and previous_config and previous_config.pagination_xpath:
    # æ–­ç‚¹æ¢å¤ï¼šä½¿ç”¨å·²ä¿å­˜é…ç½®
    pagination_xpath = previous_config.pagination_xpath
else:
    # é¦–æ¬¡è¿è¡Œï¼šé‡æ–°æå–
    pagination_xpath = await self.pagination_handler.extract_pagination_xpath()
```

## ä½¿ç”¨æ•ˆæœ

### é¦–æ¬¡è¿è¡Œ
```bash
python -m autospider collect-urls --url "https://example.com" --task "çˆ¬å–é¡¹ç›®"

# è¾“å‡ºï¼š
[Phase 2] å¯¼èˆªé˜¶æ®µï¼šæ ¹æ®ä»»åŠ¡æè¿°è¿›è¡Œç­›é€‰æ“ä½œï¼ˆLLMå†³ç­–ï¼‰...
[Phase 3] æ¢ç´¢é˜¶æ®µï¼šè¿›å…¥ 3 ä¸ªè¯¦æƒ…é¡µ...
[Phase 3.5] æå–å…¬å…± xpath...
[Phase 3.6] æå–åˆ†é¡µæ§ä»¶ xpath...
[Phase 3.6.1] æå–è·³è½¬æ§ä»¶...
# ... çº¦55ç§’åè¿›å…¥æ”¶é›†é˜¶æ®µ
```

### æ–­ç‚¹æ¢å¤ï¼ˆä¼˜åŒ–åï¼‰
```bash
# Ctrl+C ä¸­æ–­åé‡æ–°è¿è¡Œ
python -m autospider collect-urls --url "https://example.com" --task "çˆ¬å–é¡¹ç›®"

# è¾“å‡ºï¼š
[æ–­ç‚¹æ¢å¤] æ£€æµ‹åˆ°ä¸Šæ¬¡ä¸­æ–­åœ¨ç¬¬ 7 é¡µ
[æ–­ç‚¹æ¢å¤] å·²åŠ è½½ 3 ä¸ªå¯¼èˆªæ­¥éª¤
[æ–­ç‚¹æ¢å¤] å·²åŠ è½½å…¬å…±è¯¦æƒ…é¡µ XPath
[Phase 2] å¯¼èˆªé˜¶æ®µï¼šé‡æ”¾å·²ä¿å­˜çš„ 3 ä¸ªå¯¼èˆªæ­¥éª¤ï¼ˆè·³è¿‡LLMå†³ç­–ï¼‰...
[Phase 3] æ¢ç´¢é˜¶æ®µï¼šè·³è¿‡ï¼ˆå·²æœ‰å…¬å…± XPathï¼‰
[Phase 3.6] æå–åˆ†é¡µæ§ä»¶ xpathï¼šä½¿ç”¨å·²ä¿å­˜é…ç½®
[Phase 3.6.1] æå–è·³è½¬æ§ä»¶ï¼šä½¿ç”¨å·²ä¿å­˜é…ç½®
[Phase 3.7] æ–­ç‚¹æ¢å¤ï¼šå°è¯•è·³è½¬åˆ°ç¬¬ 7 é¡µ...
[æ§ä»¶ç›´è¾¾] âœ“ å·²é€šè¿‡æ§ä»¶è·³è½¬åˆ°ç¬¬ 7 é¡µ
# ... çº¦3ç§’åè¿›å…¥æ”¶é›†é˜¶æ®µï¼ˆèŠ‚çœ52ç§’ï¼ï¼‰
```

## é¢å¤–å¥½å¤„

### 1. ç¨³å®šæ€§æå‡
- âœ… é¿å… LLM è¿”å›ä¸ä¸€è‡´ç»“æœ
- âœ… ç¡®ä¿æ¯æ¬¡æ¢å¤ä½¿ç”¨ç›¸åŒçš„å¯¼èˆªè·¯å¾„
- âœ… å‡å°‘ç½‘ç»œè¯·æ±‚å¤±è´¥é£é™©

### 2. æˆæœ¬é™ä½
- ğŸ’° å‡å°‘ ~4-6 æ¬¡ LLM API è°ƒç”¨
- ğŸ’° æŒ‰ GPT-4V è®¡ç®—ï¼Œæ¯æ¬¡æ¢å¤èŠ‚çœ ~$0.05-0.10

### 3. è°ƒè¯•å‹å¥½
- ğŸ› é…ç½®æ–‡ä»¶å¯æ‰‹åŠ¨ç¼–è¾‘
- ğŸ› å¯ç›´æ¥ä¿®æ”¹ XPath è€Œæ— éœ€é‡æ–°æ¢ç´¢
- ğŸ› å¯å¤ç°ç›¸åŒçš„æ”¶é›†è·¯å¾„

## æ³¨æ„äº‹é¡¹

### ä½•æ—¶éœ€è¦æ¸…é™¤é…ç½®é‡æ–°è¿è¡Œ

å¦‚æœç½‘ç«™ç»“æ„å‘ç”Ÿå˜åŒ–ï¼Œå·²ä¿å­˜çš„ XPath å¯èƒ½å¤±æ•ˆï¼Œæ­¤æ—¶éœ€è¦ï¼š

```bash
# åˆ é™¤æ—§é…ç½®
rm output/collection_config.json
rm output/progress.json

# é‡æ–°è¿è¡Œï¼ˆå°†æ‰§è¡Œå®Œæ•´æµç¨‹ï¼‰
python -m autospider collect-urls --url "..." --task "..."
```

### è‡ªåŠ¨å¤±æ•ˆæ£€æµ‹

ä»£ç å·²åŒ…å«è‡ªåŠ¨æ£€æµ‹æœºåˆ¶ï¼š
- å¦‚æœé‡æ”¾å¯¼èˆªæ­¥éª¤å¤±è´¥ â†’ é™çº§åˆ°å½“å‰é¡µé¢ç»§ç»­
- å¦‚æœ XPath å¤±æ•ˆï¼ˆå…ƒç´ ä¸å­˜åœ¨ï¼‰â†’ åˆ‡æ¢åˆ° LLM æ”¶é›†æ¨¡å¼
- å¦‚æœåˆ†é¡µæ§ä»¶å¤±æ•ˆ â†’ åœæ­¢ç¿»é¡µ

## æ€»ç»“

é€šè¿‡é…ç½®å¤ç”¨æœºåˆ¶ï¼Œæ–­ç‚¹æ¢å¤æ€§èƒ½æå‡ **~95%**ï¼ŒåŒæ—¶æé«˜äº†ç¨³å®šæ€§å¹¶é™ä½äº†æˆæœ¬ã€‚è¿™ä½¿å¾—å¤§è§„æ¨¡æ•°æ®é‡‡é›†æ—¶çš„æ–­ç‚¹ç»­çˆ¬å˜å¾—æ›´åŠ å®ç”¨å’Œé«˜æ•ˆã€‚
