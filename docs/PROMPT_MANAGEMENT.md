# Prompt æ¨¡æ¿ç®¡ç†

## ğŸ“ æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨ **ç»Ÿä¸€çš„ Prompt æ¨¡æ¿å¼•æ“** æ¥ç®¡ç†æ‰€æœ‰ LLM çš„æç¤ºè¯ã€‚æ‰€æœ‰ prompts éƒ½ä»ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå­˜å‚¨åœ¨ `prompts/` ç›®å½•ä¸‹çš„ YAML é…ç½®æ–‡ä»¶ä¸­ã€‚

## ğŸ“ Prompt æ–‡ä»¶ä½ç½®

```
prompts/
â”œâ”€â”€ planner.yaml           # ä»»åŠ¡è§„åˆ’å™¨
â”œâ”€â”€ decider.yaml           # LLM å†³ç­–å™¨
â”œâ”€â”€ url_collector.yaml     # URL æ”¶é›†å™¨
â””â”€â”€ script_generator.yaml  # è„šæœ¬ç”Ÿæˆå™¨
```

## ğŸ¯ å¦‚ä½•ä¿®æ”¹ Prompt

### æ–¹å¼ 1: ç›´æ¥ç¼–è¾‘ YAML æ–‡ä»¶ï¼ˆæ¨èï¼‰

ç›´æ¥åœ¨ `prompts/*.yaml` æ–‡ä»¶ä¸­ä¿®æ”¹ prompt å†…å®¹ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚

ä¾‹å¦‚ï¼Œä¿®æ”¹ä»»åŠ¡è§„åˆ’å™¨çš„æç¤ºè¯ï¼š

```yaml
# prompts/planner.yaml

system_prompt: |
  ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç½‘é¡µè‡ªåŠ¨åŒ–ä»»åŠ¡è§„åˆ’ä¸“å®¶ã€‚

user_prompt: |
  æ ¹æ®ç”¨æˆ·çš„ä»»åŠ¡æè¿°å’Œç›®æ ‡ï¼Œåˆ†æä»»åŠ¡å¹¶åˆ¶å®šæ‰§è¡Œè®¡åˆ’ã€‚
  
  ## è¾“å…¥
  - èµ·å§‹URL: {{start_url}}
  - ä»»åŠ¡æè¿°: {{task}}
  - æå–ç›®æ ‡æ–‡æœ¬: {{target_text}}
  
  ## è¾“å‡ºè¦æ±‚
  ä»¥JSONæ ¼å¼è¾“å‡ºä»»åŠ¡è§„åˆ’...
```

### æ–¹å¼ 2: ä½¿ç”¨æ¨¡æ¿å¼•æ“ API

åœ¨ä»£ç ä¸­ä½¿ç”¨æ¨¡æ¿å¼•æ“ï¼š

```python
from pathlib import Path
from autospider.llm.prompt_template import render_template

# å®šä¹‰æ¨¡æ¿è·¯å¾„
PROMPT_TEMPLATE_PATH = str(
    Path(__file__).parent / "prompts" / "planner.yaml"
)

# åŠ è½½å’Œæ¸²æŸ“
system_prompt = render_template(
    PROMPT_TEMPLATE_PATH,
    section="system_prompt",
)

user_prompt = render_template(
    PROMPT_TEMPLATE_PATH,
    section="user_prompt",
    variables={
        "start_url": "https://example.com",
        "task": "æ”¶é›†è¯¦æƒ…é¡µ URL",
        "target_text": "å·²ä¸­æ ‡",
    }
)
```

## ğŸ“š è¯¦ç»†æ–‡æ¡£

- **ä½¿ç”¨æŒ‡å—**ï¼š[docs/prompt_template_guide.md](docs/prompt_template_guide.md)
- **é‡æ„æ€»ç»“**ï¼š[docs/prompt_refactor_summary.md](docs/prompt_refactor_summary.md)

## âœ… æµ‹è¯•

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯æ‰€æœ‰ prompt æ¨¡æ¿ï¼š

```bash
python tests/test_prompt_templates.py
```

é¢„æœŸè¾“å‡ºï¼š

```
================================================================================
Prompt æ¨¡æ¿ç³»ç»Ÿæµ‹è¯•
================================================================================

Jinja2 çŠ¶æ€: âœ— æœªå®‰è£…ï¼ˆä»…æ”¯æŒç®€å•å˜é‡æ›¿æ¢ï¼‰

================================================================================
æµ‹è¯•æ€»ç»“
================================================================================
planner             : âœ“ é€šè¿‡
decider             : âœ“ é€šè¿‡
url_collector       : âœ“ é€šè¿‡
script_generator    : âœ“ é€šè¿‡
================================================================================

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

## ğŸ”„ é«˜çº§åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

### å®‰è£… Jinja2 æ”¯æŒ

å®‰è£… Jinja2 åå¯ä»¥ä½¿ç”¨æ›´å¼ºå¤§çš„æ¨¡æ¿è¯­æ³•ï¼ˆå¾ªç¯ã€æ¡ä»¶ç­‰ï¼‰ï¼š

```bash
pip install jinja2
```

ç¤ºä¾‹ï¼š

```yaml
user_prompt: |
  ## å·²æ”¶é›†çš„ URL åˆ—è¡¨
  {% for url in urls %}
  - {{ url }}
  {% endfor %}
  
  {% if target_found %}
  âš ï¸ å·²æ‰¾åˆ°ç›®æ ‡ï¼
  {% else %}
  ç»§ç»­æœç´¢...
  {% endif %}
```

## ğŸ’¡ ä¼˜åŠ¿

âœ… **æ˜“äºç»´æŠ¤**ï¼šé›†ä¸­ç®¡ç†æ‰€æœ‰ promptsï¼Œä¿®æ”¹æ— éœ€æ”¹ä»£ç   
âœ… **å¯è¯»æ€§å¼º**ï¼šYAML æ ¼å¼æ¸…æ™°æ˜“è¯»ï¼Œæ”¯æŒå¤šè¡Œæ–‡æœ¬  
âœ… **å›¢é˜Ÿåä½œ**ï¼šéå¼€å‘äººå‘˜ä¹Ÿå¯ä»¥è°ƒæ•´ prompts  
âœ… **ç‰ˆæœ¬æ§åˆ¶**ï¼šä¾¿äºè·Ÿè¸ª prompt çš„å˜æ›´å†å²  
âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šLRU ç¼“å­˜å‡å°‘é‡å¤æ–‡ä»¶è¯»å–  

## ğŸ“ æœ€ä½³å®è·µ

1. åœ¨ YAML æ–‡ä»¶ä¸­ä½¿ç”¨ `#` æ·»åŠ æ³¨é‡Šè¯´æ˜ prompt çš„ç”¨é€”
2. ä¿®æ”¹ prompt åè¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯
3. ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡åï¼Œå¦‚ `{{task_description}}` è€Œä¸æ˜¯ `{{x}}`
4. å°† prompts ç›®å½•çº³å…¥ç‰ˆæœ¬æ§åˆ¶ï¼Œè·Ÿè¸ªå˜æ›´å†å²
