"""常量定义

集中管理项目中的所有常量，避免 Magic Number。
"""

from __future__ import annotations


# ============================================================================
# 爬取相关常量
# ============================================================================

# 滚动相关
DEFAULT_SCROLL_PIXELS = 500
"""默认滚动像素"""

MAX_CONSECUTIVE_BOTTOM_HITS = 3
"""连续到达页面底部的最大次数，超过后停止滚动"""

SCROLL_WAIT_MS = 500
"""滚动后等待时间（毫秒）"""


# 重试相关
DEFAULT_RETRY_COUNT = 3
"""默认重试次数"""

DEFAULT_RETRY_DELAY_SECONDS = 1.0
"""默认重试延迟（秒）"""


# 超时相关
DEFAULT_PAGE_TIMEOUT_MS = 30000
"""默认页面加载超时（毫秒）"""

DEFAULT_ELEMENT_TIMEOUT_MS = 5000
"""默认元素等待超时（毫秒）"""

DEFAULT_NAVIGATION_TIMEOUT_MS = 10000
"""默认导航超时（毫秒）"""


# ============================================================================
# LLM 相关常量
# ============================================================================

MAX_LLM_RETRIES = 3
"""LLM 请求最大重试次数"""

LLM_RETRY_DELAY_SECONDS = 2.0
"""LLM 请求重试延迟（秒）"""

MAX_PROMPT_LENGTH = 50000
"""最大 prompt 长度（字符）"""


# ============================================================================
# 验证相关常量
# ============================================================================

DEFAULT_SIMILARITY_THRESHOLD = 0.6
"""默认文本相似度阈值"""

MAX_VALIDATION_RETRIES = 3
"""验证失败后最大重试次数"""


# ============================================================================
# URL 收集相关常量
# ============================================================================

DEFAULT_EXPLORE_COUNT = 3
"""默认探索详情页数量"""

DEFAULT_TARGET_URL_COUNT = 400
"""默认目标 URL 收集数量"""

DEFAULT_MAX_PAGES = 40
"""默认最大翻页次数"""

DEFAULT_MAX_SCROLLS = 5
"""默认单页最大滚动次数"""

DEFAULT_NO_NEW_URL_THRESHOLD = 2
"""连续无新 URL 的滚动次数阈值"""


# ============================================================================
# 存储相关常量
# ============================================================================

REDIS_DEFAULT_KEY_PREFIX = "autospider:urls"
"""Redis 默认 key 前缀"""

REDIS_HASH_ID_LENGTH = 16
"""Redis key ID 哈希长度"""

PROGRESS_SAVE_INTERVAL = 10
"""进度保存间隔（页数）"""


# ============================================================================
# 输入验证常量
# ============================================================================

MAX_TASK_DESCRIPTION_LENGTH = 500
"""任务描述最大长度"""

MAX_URL_LENGTH = 2048
"""URL 最大长度"""

VALID_URL_SCHEMES = frozenset({"http", "https"})
"""有效的 URL scheme"""


# ============================================================================
# 文件相关常量
# ============================================================================

OUTPUT_URLS_FILENAME = "urls.txt"
"""输出 URL 文件名"""

OUTPUT_COLLECTED_URLS_JSON = "collected_urls.json"
"""输出收集详情 JSON 文件名"""

OUTPUT_COLLECTION_CONFIG = "collection_config.json"
"""输出爬取配置文件名"""

OUTPUT_PROGRESS_FILENAME = "progress.json"
"""输出进度文件名"""

OUTPUT_SPIDER_SCRIPT = "spider.py"
"""输出爬虫脚本文件名"""
